{"version":3,"sources":["../../src/controller/auth.controller.ts"],"sourcesContent":["import { Body, Controller, Get, Post, Query, Req, Res } from '@nestjs/common';\r\nimport { AuthService } from 'src/service/auth.service';\r\nimport { Response, Request } from 'express';\r\n\r\n@Controller('auth')\r\nexport class AuthController {\r\n  constructor(private readonly authService: AuthService) {}\r\n\r\n  @Post('login')\r\n  async login(@Body() body: any, @Res() res: Response): Promise<any> {\r\n    const { userId } = await this.authService.signIn(body);\r\n    res.cookie('userId', userId, {\r\n      httpOnly: true,\r\n      maxAge: 1000 * 60 * 60 * 24 * 3,\r\n    });\r\n  }\r\n  @Get('redirect')\r\n  async oauthRedirect(\r\n    @Query() query: { code: string },\r\n    @Res() res: Response,\r\n  ): Promise<any> {\r\n    const result = await this.authService.oauthRedirect(query?.code);\r\n    if (result?.gid) {\r\n      res.cookie('gid', result?.gid, {\r\n        httpOnly: true,\r\n        maxAge: 1000 * 60 * 60 * 24 * 1,\r\n      });\r\n    }\r\n    res.status(200).send();\r\n  }\r\n\r\n  @Get('userInfo')\r\n  async getUserInfo(@Req() req: Request): Promise<any> {\r\n    const cookies = req.cookies;\r\n    return this.authService.getUserInfo(cookies);\r\n  }\r\n}\r\n"],"names":["AuthController","login","body","res","userId","authService","signIn","cookie","httpOnly","maxAge","oauthRedirect","query","result","code","gid","status","send","getUserInfo","req","cookies","constructor"],"mappings":";;;;+BAKaA;;;eAAAA;;;wBALgD;6BACjC;yBACM;;;;;;;;;;;;;;;AAG3B,IAAA,AAAMA,iBAAN,MAAMA;IAGX,MACMC,MAAM,AAAQC,IAAS,EAAE,AAAOC,GAAa,EAAgB;QACjE,MAAM,EAAEC,MAAM,EAAE,GAAG,MAAM,IAAI,CAACC,WAAW,CAACC,MAAM,CAACJ;QACjDC,IAAII,MAAM,CAAC,UAAUH,QAAQ;YAC3BI,UAAU;YACVC,QAAQ,OAAO,KAAK,KAAK,KAAK;QAChC;IACF;IACA,MACMC,cACJ,AAASC,KAAuB,EAChC,AAAOR,GAAa,EACN;QACd,MAAMS,SAAS,MAAM,IAAI,CAACP,WAAW,CAACK,aAAa,CAACC,OAAOE;QAC3D,IAAID,QAAQE,KAAK;YACfX,IAAII,MAAM,CAAC,OAAOK,QAAQE,KAAK;gBAC7BN,UAAU;gBACVC,QAAQ,OAAO,KAAK,KAAK,KAAK;YAChC;QACF;QACAN,IAAIY,MAAM,CAAC,KAAKC,IAAI;IACtB;IAEA,MACMC,YAAY,AAAOC,GAAY,EAAgB;QACnD,MAAMC,UAAUD,IAAIC,OAAO;QAC3B,OAAO,IAAI,CAACd,WAAW,CAACY,WAAW,CAACE;IACtC;IA7BAC,YAAY,AAAiBf,WAAwB,CAAE;aAA1BA,cAAAA;IAA2B;AA8B1D"}